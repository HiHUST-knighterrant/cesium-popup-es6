<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Popup" />

    <link href="/Cesium/Widgets/widgets.css" rel="stylesheet">
    <script type="text/javascript" src="/Cesium/Cesium.js"></script>
    <script type="text/javascript" src="./CesiumEarth/dist/earthToTL.js"></script>
    <title>Label</title>
</head>

<body style="margin: 0;">
    <noscript>Label</noscript>
    <div style="width:100%; height: 100%; position: absolute;overflow: hidden;">
        <div style="width:100%; height: 100%;" id="map">

        </div>
        <div style="position: absolute; top: 0; left: 0; z-index: 5000;">
            <div style="margin: 10px;background-color: #fff; padding: 5px;cursor: pointer;" onclick="onAdd()">
                添加标签
            </div>
            <div style="margin: 10px;background-color: #fff; padding: 5px;cursor: pointer;" onclick="onSet()">
                设置所有的字体颜色为蓝色
            </div>
        </div>
    </div>
    <script>

        const viewer = new Cesium.Viewer('map', {
            imageryProvider: new Cesium.ArcGisMapServerImageryProvider({ url: "https://elevation3d.arcgis.com/arcgis/rest/services/World_Imagery/MapServer" }),
            terrainProvider: new Cesium.CesiumTerrainProvider({
                url: 'https://www.supermapol.com/realspace/services/3D-stk_terrain/rest/realspace/datas/info/data/path',
            }),
            infoBox: false,
            selectionIndicator: false,
            animation: false,
            timeline: false,
            baseLayerPicker: false
        })
        viewer.camera.flyTo({
            destination: Cesium.Cartesian3.fromDegrees(103.742546, 36.06, 30000),
        })

        const FontFamilyData = [
            { value: "SimHei", alias: "黑体" },
            { value: "SimSun", alias: "宋体" },
            { value: "Microsoft YaHei", alias: "微软雅黑" },
            { value: "Microsoft JhengHei", alias: "微软正黑体" },
            { value: "NSimSun", alias: "新宋体" },
            { value: "DFKai-SB", alias: "标楷体" },
            { value: "FangSong", alias: "仿宋" },
            { value: "KaiTi", alias: "楷体" },
            { value: "sans-serif", alias: "sans-serif" },
            { value: "serif", alias: "serif" },
            { value: "monospace", alias: "Monospace" },
            { value: "Arial", alias: "Arial" },
            { value: "Fantasy", alias: "Fantasy" },
        ];
        const option = {
            text: "欢迎使用，右键开始编辑",
            showBackground: false,
            fontSize: 24,
            fontFamily: FontFamilyData[6].value,
            style: Cesium.LabelStyle.FILL,
            fillColor: {
                r: 255,
                g: 0,
                b: 0,
                a: 0.9,
            },
            bold: true
        };


        const action = {
            remove: (entity) => {
                console.log(entity, "被移除了");

            },
            onChange: (entity, type,) => {
                if (type === "position") {
                    console.log(entity, type, "位置改变");
                }else if(type === "attribute"){
                    console.log(entity, type, "属性改变");
                }
            },
            editAttr: (entity) => {
                console.log(entity, "需要编辑属性！");

            }
        }

        const entityObj = {};//存储实体的对象


        const label1 = new EarthLabel(option).label
        const earthEntity = new EarthEntity(viewer, {
            position: Cesium.Cartesian3.fromDegrees(103.67149, 36.0, 1000),
            label: label1,
        }, action)
        entityObj[earthEntity.entity.id] = earthEntity



        //点击按钮绘制
        function onAdd() {
            const label2 = new EarthLabel(option).label
            const earthEntity = new EarthEntity(viewer, {
                label: label2,
            }, { ...action, ...{ pickPosition: true } })
            entityObj[earthEntity.entity.id] = earthEntity
        }

        function onSet() {
            //改变参数的方法，参数参见https://cesium.com/learn/cesiumjs/ref-doc/LabelGraphics.html#.ConstructorOptions
            for (let i in entityObj) {
                const e = entityObj[i]
                const oldOption = e?.options?.label?.options
                const newOption = { ...oldOption, ...{ fillColor: { r: 0, g: 0, b: 255, a: 1 } } }
                const label = new EarthLabel(newOption).label
                e.setLabel(label);
            }
        }

    </script>
</body>

</html>